<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>FinNote â€” DANA-like (HTML+CSS+JS)</title>

    <!-- Font & Icon -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">

    <!-- Loader SheetJS (multi-CDN + guard). Biarkan sebelum app.js -->
    <script>
        /* ========= Loader SheetJS (multi-CDN + flag) ========= */
        (function loadSheetJS() {
            if (window.XLSX) { window.__XLSX_READY__ = true; return; }

            function add(src, onload, onerror) {
                var s = document.createElement("script");
                s.src = src;
                s.defer = true;
                s.onload = function () {
                    console.log("SheetJS loaded:", src);
                    window.__XLSX_READY__ = true;
                    onload && onload();
                };
                s.onerror = function () {
                    console.warn("Gagal memuat:", src);
                    onerror && onerror();
                };
                document.head.appendChild(s);
            }

            // Prioritas: jsDelivr -> unpkg -> official SheetJS CDN
            add("https://cdn.jsdelivr.net/npm/xlsx@0.20.2/dist/xlsx.full.min.js", null, function () {
                add("https://unpkg.com/xlsx@0.20.2/dist/xlsx.full.min.js", null, function () {
                    add("https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js", null, function () {
                        console.warn("Semua CDN SheetJS gagal dimuat.");
                    });
                });
            });
        })();
    </script>
</head>

<body>
    <div class="app tabs">
        <!-- NAV radios -->
        <input type="radio" id="tab-home" name="tab" checked>
        <input type="radio" id="tab-wallet" name="tab">
        <input type="radio" id="tab-stats" name="tab">
        <input type="radio" id="tab-settings" name="tab">

        <header class="appbar">
            <div class="appbar__inner">
                <div class="avatar">A</div>
                <div class="hello">
                    <small>Selamat datang,</small><br><b>Aryo Abi Putra</b>
                </div>
            </div>
        </header>

        <main>
            <!-- HOME -->
            <section id="home" class="screen">
                <div class="balance-card card">
                    <div class="tag">Total Saldo</div>
                    <div class="balance-amount" id="totalBalance">Rp 0</div>
                    <div class="subtext" id="summaryText">Ringkasan dari 0 dompet aktif</div>
                </div>

                <div class="home-stack">
                    <!-- Saldo per Dompet -->
                    <div class="card pad">
                        <div class="sect-title"><i class="fa-solid fa-wallet"></i> Saldo per Dompet <span class="mini"
                                id="walletCountHint"></span></div>
                        <div id="homeWalletList"></div>
                    </div>

                    <!-- Riwayat Singkat -->
                    <div class="card pad">
                        <div class="sect-title"><i class="fa-solid fa-clock-rotate-left"></i> Riwayat Singkat <span
                                class="mini">â€¢ 10 terbaru</span></div>
                        <div id="recentTx"></div>
                        <div class="divider"></div>
                        <div class="center">
                            <button id="btnOpenTx" class="btn-ghost"><i class="fa-solid fa-plus"></i> Tambah
                                Transaksi</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- WALLET -->
            <section id="wallet" class="screen">
                <div class="card pad">
                    <div class="sect-title"><i class="fa-solid fa-wallet"></i> Daftar Wallet <span class="mini">â€¢ Taruh
                            semua akun kamu</span></div>
                    <div class="divider"></div>
                    <div id="walletList"></div>
                    <div class="center" style="margin-top:12px">
                        <button id="btnOpenAdd" class="btn-ghost"><i class="fa-solid fa-plus"></i> Tambah
                            Wallet</button>
                    </div>
                    <div class="hint" style="margin-top:8px">Klik ikon ðŸ—‘ untuk menghapus wallet (transaksi terkait ikut
                        dihapus).</div>
                </div>
            </section>

            <!-- STATS -->
            <section id="stats" class="screen">
                <div class="card pad">
                    <div class="sect-title"><i class="fa-solid fa-sliders"></i> Filter Statistik</div>
                    <div class="controls">
                        <select id="statsWallet" class="select"></select>
                        <div class="segmented">
                            <button id="btnDonutExpense" class="seg active">Pengeluaran</button>
                            <button id="btnDonutIncome" class="seg">Pemasukan</button>
                        </div>
                    </div>
                    <div class="hint" style="margin-top:8px">Pilih "Semua Dompet" atau satu dompet, lalu pilih jenis
                        donut.</div>
                </div>

                <div class="card pad chart-card">
                    <div id="donut" class="donut" title="Donut"></div>
                    <div>
                        <div class="sect-title"><i class="fa-solid fa-chart-pie"></i> Rincian per Kategori</div>
                        <div id="legend" class="legend"></div>
                        <div class="divider"></div>
                        <div class="muted" id="totalByType">Total: Rp 0</div>
                    </div>
                </div>

                <div class="card pad">
                    <div class="sect-title"><i class="fa-solid fa-chart-column"></i> Pemasukan vs Pengeluaran â€¢ 6 Bulan
                        Terakhir</div>
                    <div id="bars" class="bars"></div>
                    <div class="hint" style="margin-top:8px">Hijau = pemasukan, Biru = pengeluaran. Dibuat berdampingan
                        untuk mudah dibandingkan.</div>
                </div>
            </section>

            <!-- SETTINGS -->
            <section id="settings" class="screen">
                <div class="card pad center" style="padding:24px">
                    <div class="sect-title" style="justify-content:center"><i class="fa-solid fa-list"></i> Kategori &
                        Export</div>
                    <div class="center" style="gap:10px">
                        <button id="btnOpenCats" class="btn-ghost"><i class="fa-solid fa-tags"></i> Kelola
                            Kategori</button>
                        <button id="btnExportXlsx" class="btn-ghost"
                            style="background:linear-gradient(135deg,#22c55e,#16a34a); box-shadow:0 10px 24px rgba(22,163,74,.35)">
                            <i class="fa-solid fa-download"></i> Export ke Excel
                        </button>
                    </div>
                    <div class="hint" style="margin-top:10px">Export memakai SheetJS (client-side).</div>
                </div>
            </section>
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottomnav card">
            <label class="navbtn" for="tab-home"><i class="fa-solid fa-house"></i><span>Home</span></label>
            <label class="navbtn" for="tab-wallet"><i class="fa-solid fa-wallet"></i><span>Wallet</span></label>
            <label class="navbtn" for="tab-stats"><i class="fa-solid fa-chart-column"></i><span>Statistik</span></label>
            <label class="navbtn" for="tab-settings"><i class="fa-solid fa-gear"></i><span>Setting</span></label>
        </nav>
    </div>

    <!-- MODALS -->
    <div class="modal" id="modalAddWallet">
        <div class="modal-card">
            <div class="sect-title"><i class="fa-solid fa-plus"></i> Tambah Wallet</div>
            <div class="form-row">
                <input id="inWName" class="input" type="text" placeholder="Nama Wallet (contoh: Bank BRI)" />
                <input id="inWNote" class="input" type="text" placeholder="Catatan/Label (contoh: Utama / Belanja)" />
                <input id="inWBalance" class="input" type="number" inputmode="numeric"
                    placeholder="Saldo awal (contoh: 1500000)" />
                <select id="inWTheme" class="select">
                    <option value="blue|fa-building-columns" selected>Bank â€¢ Biru</option>
                    <option value="green|fa-mobile-screen">E-Wallet â€¢ Hijau</option>
                    <option value="amber|fa-piggy-bank">Tabungan â€¢ Oranye</option>
                </select>
            </div>
            <div class="form-row" style="justify-items:end">
                <button data-close="#modalAddWallet" class="btn-secondary">Batal</button>
                <button id="btnDoAddWallet" class="btn-primary">Simpan</button>
            </div>
        </div>
    </div>

    <div class="modal" id="modalTx">
        <div class="modal-card">
            <div class="sect-title"><i class="fa-solid fa-plus"></i> <span id="txModalTitle">Tambah Transaksi</span>
            </div>
            <div class="form-row">
                <div style="display:grid; grid-auto-flow:column; gap:8px; justify-content:start">
                    <span id="tagIn" class="tagtype tag-in" data-type="in">Pemasukan</span>
                    <span id="tagOut" class="tagtype tag-out" data-type="out">Pengeluaran</span>
                </div>
                <input id="inAmount" class="input" type="number" inputmode="numeric"
                    placeholder="Nominal (contoh: 125000)" />
                <select id="inWallet" class="select"></select>
                <select id="inCategory" class="select"></select>
                <input id="inNoteTx" class="input" type="text" placeholder="Catatan (opsional)" />
                <input id="inDate" class="date" type="date" />
                <div class="hint" id="catHint" style="display:none">Belum ada kategori untuk tipe ini. Tambahkan di
                    <b>Setting â†’ Kelola Kategori</b>.
                </div>
            </div>
            <div class="form-row" style="grid-auto-flow:column; justify-content:space-between">
                <button id="btnDeleteTx" class="btn-danger" style="display:none"><i class="fa-solid fa-trash-can"></i>
                    Hapus</button>
                <div style="display:grid; grid-auto-flow:column; gap:10px; justify-content:end">
                    <button data-close="#modalTx" class="btn-secondary">Batal</button>
                    <button id="btnDoSaveTx" class="btn-primary">Simpan</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="modalCats">
        <div class="modal-card">
            <div class="sect-title"><i class="fa-solid fa-tags"></i> Kelola Kategori</div>
            <div class="form-row">
                <select id="catType" class="select">
                    <option value="income">Pemasukan</option>
                    <option value="expense">Pengeluaran</option>
                </select>
                <div style="display:grid; grid-auto-flow:column; gap:8px; align-items:center">
                    <input id="catName" class="input" type="text" placeholder="Nama kategori (mis. Gaji / Makan)" />
                    <button id="btnAddCat" class="btn-primary">Tambah</button>
                </div>
                <div id="catList"></div>
            </div>
            <div class="form-row" style="justify-items:end">
                <button data-close="#modalCats" class="btn-secondary">Selesai</button>
            </div>
        </div>
    </div>

    <!-- App -->
    <script src="app.js"></script>
</body>

</html>
